<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forum</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #121212; color: #fff; }
    .card { background-color: #1e1e1e; border: 1px solid #333; margin-bottom: 1rem; }
    .card-img-top { height: 500px; object-fit: cover; }
    .username { font-size: 0.8rem; color: #aaa; }
    .btn-danger { margin-left: auto; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Forum</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="login.html" id="loginLink">Login</a>
        <a class="nav-link" href="register.html" id="registerLink">Register</a>
        <a class="nav-link d-none" href="#" id="postLink" data-bs-toggle="offcanvas" data-bs-target="#postPanel">Post Oluştur</a>
        <a class="nav-link d-none" href="#" id="logoutLink">Logout</a>
      </div>
    </div>
  </div>
</nav>

<div class="container mt-4" id="postContainer"></div>

<div class="offcanvas offcanvas-end text-white" tabindex="-1" id="postPanel" style="background-color:#1e1e1e;width:400px;">
  <div class="offcanvas-header border-bottom border-secondary">
    <h5 class="offcanvas-title">Post Oluştur</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <form id="postForm" class="needs-validation" novalidate>
      <div class="mb-3">
        <input type="file" id="pfile" accept="image/*" class="form-control" required
               style="background-color:#2c2c2c;color:#fff;border:1px solid #444;">
        <div class="invalid-feedback">Post görseli ekleyiniz.</div>
      </div>
      <div class="form-floating mb-3">
        <input type="text" id="pname" class="form-control" placeholder="Başlık" required
               style="background-color:#2c2c2c;color:#fff;border:1px solid #444;">
        <label for="pname" style="color:#ccc;">Başlık</label>
        <div class="invalid-feedback">Başlık gerekli.</div>
      </div>
      <div class="form-floating mb-3">
        <textarea id="picerik" class="form-control" style="height:100px;background-color:#2c2c2c;color:#fff;border:1px solid #444;" required></textarea>
        <label for="picerik" style="color:#ccc;">İçerik</label>
        <div class="invalid-feedback">İçerik gerekli.</div>
      </div>
      <div class="d-grid">
        <button class="btn btn-primary" type="submit">Paylaş</button>
      </div>
    </form>
  </div>
</div>

<div class="container mt-5 d-none" id="detailView">
  <div class="card mx-auto" style="max-width: 600px;">
    <img src="" id="detailImg" class="card-img-top">
    <div class="card-body">
      <p class="username" id="detailUser"></p>
      <h5 class="card-title" id="detailTitle"></h5>
      <p class="card-text" id="detailContent"></p>
      <a href="index.html" class="btn btn-secondary">Geri Dön</a>
    </div>
  </div>
</div>

<script>
  const loginUser = localStorage.getItem("loggedInUser");
  const postForm = document.getElementById("postForm");
  const postContainer = document.getElementById("postContainer");
  const detailView = document.getElementById("detailView");
  const detailTitle = document.getElementById("detailTitle");
  const detailImg = document.getElementById("detailImg");
  const detailContent = document.getElementById("detailContent");
  const detailUser = document.getElementById("detailUser");

  const loginLink = document.getElementById("loginLink");
  const registerLink = document.getElementById("registerLink");
  const postLink = document.getElementById("postLink");
  const logoutLink = document.getElementById("logoutLink");

  function showPosts() {
    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    postContainer.innerHTML = "";
    posts.forEach((post, index) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${post.image}" class="card-img-top">
        <div class="card-body">
          <p class="username">${post.user}</p>
          <h5 class="card-title">${post.title}</h5>
          <p class="card-text">${post.content.substring(0, 100)}...</p>
          <div class="d-flex">
            <button class="btn btn-primary btn-sm" onclick="viewPost(${index})">Tamamını Görüntüle</button>
            ${loginUser === post.user ? `<button class="btn btn-danger btn-sm ms-2" onclick="deletePost(${index})">Sil</button>` : ""}
          </div>
        </div>
      `;
      postContainer.appendChild(card);
    });
  }

  function viewPost(index) {
    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    const post = posts[index];
    detailTitle.textContent = post.title;
    detailImg.src = post.image;
    detailContent.textContent = post.content;
    detailUser.textContent = "Gönderen: " + post.user;
    document.getElementById("postContainer").classList.add("d-none");
    detailView.classList.remove("d-none");
  }

  function deletePost(index) {
    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    if (posts[index].user === loginUser) {
      posts.splice(index, 1);
      localStorage.setItem("posts", JSON.stringify(posts));
      showPosts();
    }
  }

  postForm?.addEventListener("submit", function (e) {
    e.preventDefault();
    if (!postForm.checkValidity()) {
      postForm.classList.add("was-validated");
      return;
    }

    const reader = new FileReader();
    const file = document.getElementById("pfile").files[0];
    const title = document.getElementById("pname").value;
    const content = document.getElementById("picerik").value;

    reader.onload = function () {
      const image = reader.result;
      const posts = JSON.parse(localStorage.getItem("posts") || "[]");
      posts.unshift({ image, title, content, user: loginUser });
      localStorage.setItem("posts", JSON.stringify(posts));
      postForm.reset();
      postForm.classList.remove("was-validated");
      bootstrap.Offcanvas.getInstance(document.getElementById("postPanel")).hide();
      showPosts();
    };

    if (file) reader.readAsDataURL(file);
  });

  logoutLink.addEventListener("click", function () {
    localStorage.removeItem("loggedInUser");
    location.reload();
  });

  if (loginUser) {
    loginLink.classList.add("d-none");
    registerLink.classList.add("d-none");
    postLink.classList.remove("d-none");
    logoutLink.classList.remove("d-none");
  }

  showPosts();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
