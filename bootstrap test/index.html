<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forum</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Forum</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
          <a class="nav-link" href="login.html">Login</a>
          <a class="nav-link" href="register.html">Register</a>
          <a class="nav-link" type="button" data-bs-toggle="offcanvas" data-bs-target="#postPanel">Posts</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container my-4">
    <div id="postsContainer" class="row gy-3">
    </div>
  </div>

  <div
    class="offcanvas offcanvas-end text-white"
    tabindex="-1"
    id="postPanel"
    style="background-color: #1e1e1e; width: 400px;"
  >
    <div class="offcanvas-header" style="border-bottom: 1px solid #444;">
      <h5 class="offcanvas-title">Post Oluştur</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Kapat"></button>
    </div>

    <div class="offcanvas-body">
      <form id="postForm" class="needs-validation" novalidate>
        <div class="mb-3">
          <input
            type="file"
            name="pfile"
            class="form-control"
            id="pfile"
            accept="image/*"
            required
            style="background-color: #2c2c2c; color: #fff; border: 1px solid #444;"
          />
          <div class="invalid-feedback">Geçerli bir post görüntüsü giriniz.</div>
        </div>

        <div class="form-floating mb-3">
          <input
            type="text"
            name="pname"
            class="form-control"
            id="pname"
            placeholder="Post başlık"
            required
            style="background-color: #2c2c2c; color: #fff; border: 1px solid #444;"
          />
          <label for="pname" style="color: #ccc;">Post Başlık</label>
          <div class="invalid-feedback">Geçerli bir post başlığı giriniz.</div>
        </div>

        <div class="form-floating mb-3">
          <textarea
            name="picerik"
            class="form-control"
            id="picerik"
            placeholder="İçerik"
            style="height: 100px; background-color: #2c2c2c; color: #fff; border: 1px solid #444;"
            required
          ></textarea>
          <label for="picerik" style="color: #ccc;">İçerik</label>
          <div class="invalid-feedback">Lütfen içerik giriniz.</div>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary">Gönder</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (() => {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
            return;
          }
          event.preventDefault();

          const fileInput = form.querySelector('#pfile');
          const titleInput = form.querySelector('#pname');
          const contentInput = form.querySelector('#picerik');

          const file = fileInput.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function (e) {
            const imgSrc = e.target.result;

            const postHTML = `
              <div class="col-12 col-md-6 col-lg-4">
                <div class="card bg-dark text-white h-100">
                  <img src="${imgSrc}" class="card-img-top" alt="Post Image" style="object-fit: cover; height: 200px;" />
                  <div class="card-body">
                    <h5 class="card-title">${titleInput.value}</h5>
                    <p class="card-text">${contentInput.value}</p>
                  </div>
                </div>
              </div>
            `;

            const postsContainer = document.getElementById('postsContainer');
            postsContainer.insertAdjacentHTML('afterbegin', postHTML);

            form.classList.remove('was-validated');
            form.reset();

            
            const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('postPanel'));
            offcanvas.hide();
          };
          reader.readAsDataURL(file);
        });
      });
    })();
  </script>
</body>
</html>
